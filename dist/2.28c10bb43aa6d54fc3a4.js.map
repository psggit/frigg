{"version":3,"sources":["webpack:///./src/react-apps/login/index.js","webpack:///./src/react-apps/login/utils.js","webpack:///./src/react-apps/login/form.js"],"names":["__webpack_require__","Login","_classCallCheck","this","_possibleConstructorReturn","__proto__","Object","getPrototypeOf","call","_react2","default","Component","location","href","split","length","history","pushState","localStorage","getItem","createElement","_MuiThemeProvider2","style","padding","color","_form2","getHasuraRole","data","hasuraRoles","hasura_roles","rolesMap","admin","dataadmin","dataentry","support_admin","support_master","support_person","business_team","delivery_support_person","user","maxRole","xHasuraRole","i","getAuthToken","auth_token","getHasuraId","hasura_id","createSession","setItem","_react","_utils","_config","Form","_this","state","isSubmitting","showError","error","username","password","handleChange","bind","handlePress","handleSubmit","e","_setState","setState","_defineProperty","target","name","value","keyCode","_this2","_state","formData","fetchOptions","method","headers","Accept","Content-Type","credentials","mode","body","JSON","stringify","fetch","Api","authUrl","then","response","status","console","log","json","catch","err","marginTop","className","placeholder","type","onChange","onKeyDown","disabled","onClick","cursor"],"mappings":"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","file":"2.28c10bb43aa6d54fc3a4.js","sourcesContent":["import React from 'react'\nimport Form from './form'\nimport MuiThemeProvider from 'material-ui/styles/MuiThemeProvider'\n\nclass Login extends React.Component {\n  constructor() {\n    super()\n  }\n\n  componentWillMount() {\n    if (!location.href.split('/')[3].length) history.pushState(null, null, '/login')\n    if (localStorage.getItem('_hipbaru')) {\n      location.href = '/home'\n    }\n  }\n\n  render() {\n    return (\n      <MuiThemeProvider>\n        <div style={{ padding: '0 10%' }}>\n          <h1 style={{ color: '#333'}}>@hipbar</h1>\n          <hr />\n          <Form />\n        </div>\n      </MuiThemeProvider>\n    )\n  }\n}\n\nexport default Login\n","export function getHasuraRole(data) {\n  const hasuraRoles = data.hasura_roles\n  // const hasuraRoles = [\"user\", \"support_person\", \"excise\", \"support_admin\"]\n  const rolesMap = {\n    admin: 8,\n    dataadmin: 7,\n    dataentry: 6,\n    support_admin: 5,\n    support_master: 4,\n    support_person: 3,\n    business_team: 9,\n    delivery_support_person: 3,\n    user: 1\n  }\n  let maxRole = rolesMap[\"user\"]\n  let xHasuraRole = \"user\"\n  for(let i=0; i<hasuraRoles.length; i++) {\n    if (maxRole < rolesMap[hasuraRoles[i]]) {\n      maxRole = rolesMap[hasuraRoles[i]]\n      xHasuraRole = hasuraRoles[i]\n    }\n  }\n  return xHasuraRole\n}\n\nexport function getAuthToken(data) {\n  const token = data.auth_token\n  return token\n}\n\nexport function getHasuraId(data) {\n  const hasuraId = data.hasura_id\n  return hasuraId\n}\n\nexport function createSession(data) {\n  localStorage.setItem('x-hasura-role', getHasuraRole(data))\n  localStorage.setItem('auth-token', getAuthToken(data))\n  localStorage.setItem('hasura-id', getHasuraId(data))\n}\n","import React, { Fragment } from 'react'\nimport { createSession } from './utils'\nimport {  Api } from '@utils/config'\nimport \"whatwg-fetch\"\nimport '@sass/components/_input.scss'\nimport '@sass/components/_form.scss'\nimport '@sass/components/_button.scss'\n\nclass Form extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      isSubmitting: false,\n      showError: false,\n      error: false,\n      username: '',\n      password: ''\n    }\n\n    this.handleChange = this.handleChange.bind(this)\n    this.handlePress = this.handlePress.bind(this)\n    this.handleSubmit = this.handleSubmit.bind(this)\n  }\n\n  handleChange(e) {\n    this.setState({ [e.target.name]: e.target.value, error: false })\n  }\n\n  handlePress(e) {\n    if (e.keyCode === 13) this.handleSubmit()\n  }\n\n\n  handleSubmit() {\n    const { username, password } = this.state\n    if (!(username.length && password.length)) {\n      console.log('poiuytyuio');\n      return;\n    }\n    const formData = {\n      username,\n      password\n    }\n\n    const fetchOptions = {\n      method: 'post',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      credentials: 'include',\n      mode: 'cors',\n      body: JSON.stringify(formData)\n    }\n\n    this.setState({isSubmitting: true})\n\n    fetch(`${Api.authUrl}/login`, fetchOptions)\n      .then((response) => {\n        if (response.status !== 200) {\n          console.log(`Looks like there was a problem. Status Code: ${response.status}`)\n          this.setState({ isSubmitting: false, error: true })\n          return\n        }\n        response.json().then((data) => {\n          localStorage.setItem('_hipbaru', JSON.stringify(data))\n          createSession(data)\n          location.href = '/home'\n          // if (document.referrer) {\n          //   location.href = document.referrer\n          // } else {\n          //   location.href = '/home'\n          // }\n        })\n      })\n      .catch((err) => {\n        console.log('Fetch Error :-S', err)\n        this.setState({ isSubmitting: false })\n      })\n  }\n\n  render() {\n    return (\n      <div style={{ marginTop: '40px' }}>\n        <div className=\"form-group\">\n          <input\n            placeholder=\"username\"\n            type=\"text\"\n            name=\"username\"\n            onChange={this.handleChange}\n            onKeyDown={this.handlePress}\n          />\n        </div>\n        <div className=\"form-group\">\n          <input\n            placeholder=\"password\"\n            type=\"password\"\n            name=\"password\"\n            onChange={this.handleChange}\n            onKeyDown={this.handlePress}\n          />\n        </div>\n        <button\n          disabled={this.state.isSubmitting}\n          onClick={this.handleSubmit}\n          style={{ marginTop: '20px', cursor: this.state.isSubmitting ? 'progress' : '' }}\n          className=\"btn btn--primary\"\n        >\n          Login\n        </button>\n        { this.state.error ? <p style={{ color: '#ff3b30' }}>Wrong username or password</p> : ''}\n      </div>\n    )\n  }\n}\n\nexport default Form\n"],"sourceRoot":""}